---
title: "Airレジデータ分析システム - 改訂版アプローチ"
type: documentation
status: active
created: "2025-10-14"
updated: "2025-10-14"
tags:
  - "project/airregi-analytics"
---

# Airレジデータ分析システム - 改訂版アプローチ

**改訂日**: 2025年10月14日
**理由**: バックオフィスAPIが実際には存在しない

---

## 🔄 状況の変更

### 判明した事実
- ❌ Airレジ バックオフィスが存在しない
- ❌ 直接的なAPI連携が困難
- ✅ 手動でのデータエクスポートが必要

### 新しい要件
1. **PCでローカルに情報を取得**
2. **Google Sheetsへのインポート**

---

## 📊 新しいシステム設計

### データフロー

```
┌─────────────┐
│ Airレジアプリ │
│  (iPad/PC)  │
└──────┬──────┘
       │ 手動エクスポート
       │ (CSV/Excel)
       ↓
┌─────────────────────┐
│ ローカルPC           │
│ (フォルダ監視)       │
└──────┬──────────────┘
       │ 自動検知
       ↓
┌─────────────────────┐
│ データ処理           │
│ (CSVパース)         │
└──────┬──────────────┘
       │
       ├─→ ローカル保存 (JSON/Excel)
       │
       └─→ Google Sheets 自動アップロード
```

---

## 🎯 実装アプローチ

### アプローチ1: CSV/Excelファイルの自動処理

#### 仕組み
1. Airレジアプリからデータをエクスポート（手動）
2. 指定フォルダにファイルを保存
3. フォルダ監視スクリプトが自動検知
4. データ処理・分析を自動実行
5. 結果を保存 & Google Sheetsにアップロード

#### 必要な機能
- ✅ CSVインポート機能
- ✅ Excelインポート機能（openpyxl使用）
- 🆕 フォルダ監視機能
- 🆕 Google Sheets API連携

### アプローチ2: Google Sheetsを中心としたワークフロー

#### 仕組み
1. Airレジデータを手動でGoogle Sheetsにコピー
2. Google Apps Scriptで自動処理
3. 分析結果を別シートに出力

---

## 💻 実装すべき機能

### 1. CSVインポート機能（優先度：高）

**ファイル**: `import_csv.py`

```python
# 機能
- CSVファイルの読み込み
- データのバリデーション
- 既存の分析エンジンとの連携
- レポート生成
```

**使用方法**:
```bash
python import_csv.py --file airregi_export.csv
```

### 2. フォルダ監視機能（優先度：中）

**ファイル**: `folder_watcher.py`

```python
# 機能
- 指定フォルダの監視
- 新規ファイル検知
- 自動処理トリガー
```

**使用方法**:
```bash
python folder_watcher.py --watch ~/Downloads/airregi/
```

### 3. Google Sheets連携（優先度：中）

**ファイル**: `google_sheets_sync.py`

```python
# 機能
- Google Sheets APIでの認証
- データのアップロード
- スプレッドシート作成・更新
```

**使用方法**:
```bash
python google_sheets_sync.py --file report.xlsx
```

---

## 🛠️ 実装計画

### Phase 1: CSVインポート機能（即座に実装可能）

```bash
# 実装ファイル
- import_csv.py        # CSVインポートメイン
- src/data/parser.py   # データパース処理
```

**実装時間**: 1-2時間

### Phase 2: フォルダ監視機能

```bash
# 必要なパッケージ
watchdog==3.0.0

# 実装ファイル
- folder_watcher.py
```

**実装時間**: 2-3時間

### Phase 3: Google Sheets連携

```bash
# 必要なパッケージ
google-auth==2.25.0
google-auth-oauthlib==1.2.0
google-api-python-client==2.110.0

# 実装ファイル
- google_sheets_sync.py
- src/integrations/google_sheets.py
```

**実装時間**: 3-4時間

---

## 📋 Airレジからのデータエクスポート方法

### 推定される方法（要確認）

1. **Airレジアプリ内でのエクスポート**
   - 売上管理画面
   - エクスポート or ダウンロードボタン
   - CSV/Excel形式で保存

2. **メール送信**
   - レポートをメールで送信
   - 添付ファイルをダウンロード

3. **AirID経由（可能性）**
   - Recruit IDでログイン
   - Web上でデータダウンロード

### 確認すべき情報
- [ ] エクスポート可能なデータ形式
- [ ] エクスポートできるデータの種類
- [ ] エクスポート可能な期間
- [ ] ファイル形式（CSV, Excel, JSON?）
- [ ] データ構造（カラム名、フィールド）

---

## 🚀 即座に始められる手順

### ステップ1: サンプルCSVでテスト

既にサンプルデータがあるので、CSV形式に変換してテスト：

```bash
# サンプルデータをCSVに変換
python create_sample_csv.py

# CSVをインポートして分析
python import_csv.py --file data/sample/transactions.csv
```

### ステップ2: 実際のAirレジデータでテスト

1. Airレジアプリからデータをエクスポート
2. エクスポートしたファイルを確認
3. ファイル形式に合わせてインポート機能を調整
4. 分析実行

### ステップ3: 自動化

1. フォルダ監視機能を追加
2. Google Sheets連携を追加
3. 定期実行設定（不要なら省略）

---

## 💡 推奨ワークフロー

### シンプルな運用フロー

```
1. Airレジでデータエクスポート（毎日 or 週次）
   ↓
2. ファイルを指定フォルダに保存
   ↓
3. スクリプトを実行（手動 or 自動）
   python import_csv.py --file exported_data.csv
   ↓
4. 分析結果を確認
   - data/processed/ に JSON保存
   - reports/ に Excel保存
   - （オプション）Google Sheetsにアップロード
```

### 自動化された運用フロー

```
1. Airレジでデータエクスポート
   ↓
2. ファイルをDropbox/Googleドライブの指定フォルダに保存
   ↓
3. フォルダ監視スクリプトが自動検知
   ↓
4. 自動で分析 & レポート生成
   ↓
5. Google Sheetsに自動アップロード
   ↓
6. Slack/メールで通知（オプション）
```

---

## 🎯 次のアクション

### 最優先: Airレジのデータエクスポート方法を確認

以下のいずれかの方法で確認：

1. **Airレジアプリを確認**
   - 売上管理画面を開く
   - エクスポート or ダウンロード機能を探す
   - サンプルデータをエクスポート

2. **Airレジサポートに問い合わせ**
   ```
   件名: 売上データのエクスポート方法について

   お世話になります。
   Airレジの売上データをPCで分析したいと考えております。

   以下についてご教示ください：
   1. 売上データのエクスポート方法
   2. エクスポート可能なデータ形式（CSV, Excel等）
   3. エクスポートできるデータの種類と期間
   4. サンプルのエクスポートファイル

   よろしくお願いいたします。
   ```

### 並行作業: CSVインポート機能の実装

Airレジの仕様確認を待つ間、汎用的なCSVインポート機能を実装：

```bash
# CSVインポート機能を実装
# - 柔軟なカラムマッピング
# - 複数形式への対応
# - エラーハンドリング
```

---

## 🔧 必要なツール・パッケージ

### 追加パッケージ（Phase別）

**Phase 1: CSVインポート**
```
pandas==2.3.3          # 既にインストール済み
openpyxl==3.1.5        # 既にインストール済み
```

**Phase 2: フォルダ監視**
```
watchdog==3.0.0
```

**Phase 3: Google Sheets連携**
```
google-auth==2.25.0
google-auth-oauthlib==1.2.0
google-api-python-client==2.110.0
gspread==5.12.0
```

---

## 📊 想定されるAirレジデータ構造

### エクスポートされる可能性が高いデータ

**取引データ（transactions.csv）**:
```csv
日付,時刻,伝票番号,商品名,数量,単価,金額,支払方法,スタッフ
2025-10-14,12:30:00,T001,ランチセットA,1,1200,1320,現金,田中
2025-10-14,12:35:00,T002,カレーライス,1,900,990,クレジットカード,佐藤
```

**精算データ（settlement.csv）**:
```csv
日付,総売上,現金,クレジットカード,電子マネー,QRコード,取引件数
2025-10-14,184910,61435,39710,54450,29315,58
```

**実際の構造に合わせて調整が必要**

---

## ✅ 既存システムの活用

### 再利用可能な機能

- ✅ **データ分析エンジン** (`src/analysis/analyzer.py`)
  - そのまま使用可能
  - 入力データ形式を調整するだけ

- ✅ **レポート生成**
  - JSON/Excel出力機能
  - そのまま使用可能

- ✅ **ログシステム**
  - 変更不要

### 新規実装が必要な機能

- 🆕 CSVインポート
- 🆕 データパース・マッピング
- 🆕 フォルダ監視（オプション）
- 🆕 Google Sheets連携（オプション）

---

## 🎉 メリット

### この方式のメリット

1. **シンプル**
   - API仕様の不確実性がない
   - 確実に動作する

2. **柔軟**
   - どんなデータ形式にも対応可能
   - 手動実行 or 自動実行の選択可能

3. **拡張性**
   - Google Sheets連携で可視化
   - 他のツールとの連携も容易

4. **既存資産の活用**
   - 既に実装済みの分析エンジンを活用
   - 開発工数最小化

---

**次のステップ**: Airレジアプリでデータエクスポート方法を確認し、サンプルファイルを取得してください。
